<div class="container-fluid">
  <div class="card my-3">
    <div class="card-header bg-light py-3">
      <h4 class="mb-0">Purchases</h4>
    </div>

    <div class="card-body">
      <!-- Filters Section -->
      <div class="row mb-3">
        <div class="col-12">
       
        </div>
      </div>

      <!-- All Purchases Section -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">All Purchases</h5>
        <button class="btn btn-primary " [routerLink]="['/add-purchase']">
          <i class="fas fa-plus"></i> Add
        </button>
      </div>

      <!-- Export Options and Search -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="d-flex align-items-center">
          <label class="me-2">Show</label>
          <select class="form-select form-select-sm me-2" style="width: 70px;">
            <option>25</option>
            <option>50</option>
            <option>100</option>
          </select>
          <label>entries</label>
        </div>
        
        <div class="btn-group">
          <button class="btn btn-sm btn-outline-secondary" (click)="exportToCSV()">
            <i class="fas fa-file-csv me-1"></i> Export CSV
          </button>
          <button class="btn btn-sm btn-outline-secondary" (click)="exportToExcel()">
            <i class="fas fa-file-excel me-1"></i> Export Excel
          </button>
          <button class="btn btn-sm btn-outline-secondary" (click)="print()">
            <i class="fas fa-print me-1"></i> Print
          </button>
          <button class="btn btn-sm btn-outline-secondary" (click)="exportToPDF()">
            <i class="fas fa-file-pdf me-1"></i> Export PDF
          </button>
        </div>
        
        <div class="form-group mb-0">
          <input type="text" class="form-control form-control-sm" placeholder="Search..." [(ngModel)]="searchText" (input)="applyFilter()">
        </div>
      </div>

      <!-- Main Table -->
      <div class="table-responsive">
        <table class="table table-hover no-vertical-lines" id="purchaseTable">
          <thead class="table-light">
            <tr>
              <th>Date <i class="fas fa-sort"></i></th>
              <th>Reference No <i class="fas fa-sort"></i></th>
              <th>Location <i class="fas fa-sort"></i></th>
              <th>Supplier <i class="fas fa-sort"></i></th>
              <th>Purchase Status <i class="fas fa-sort"></i></th>
              <th>Payment Status <i class="fas fa-sort"></i></th>
              <th>Grand Total <i class="fas fa-sort"></i></th>
              <th>Payment due <i class="fas fa-question-circle text-info"></i> <i class="fas fa-sort"></i></th>
              <th>Added By <i class="fas fa-sort"></i></th>
              <th>Action <i class="fas fa-sort"></i></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngIf="isLoading">
              <td colspan="10" class="text-center">
                <div class="spinner-border" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </td>
            </tr>
            
            <tr *ngFor="let purchase of filteredPurchases">
              <td>{{ purchase.purchaseDate || 'N/A' }}</td>
              <td>{{ purchase.referenceNo || 'N/A' }}</td>
              <td>{{ purchase.businessLocation || 'N/A' }}</td>
              <td>{{ purchase.supplier|| 'N/A' }}</td>
              <td>
                <span [class]="getStatusClass(purchase.purchaseStatus)">
                  {{ purchase.purchaseStatus || 'Unknown' }}
                </span>
              </td>              <td>{{ purchase.paymentStatus || 'Unknown' }}</td>
              <td>₹ {{ purchase.grandTotal || '0.00' }}</td>
              <td>₹ {{ purchase.paymentDue || '0.00' }}</td>
              <td>{{ purchase.addedBy || 'System' }}</td>
              <td>
                <div class="btn-group">
               <!-- Change the view button to use routerLink -->
<button class="btn border-0 shadow-none bg-transparent p-0" 
[routerLink]="['/view-purchase', purchase.id]">
<i class="fas fa-eye text-primary"></i>
</button>
                  <button class="btn btn-danger border-0 shadow-none bg-transparent p-0 ms-2" (click)="deletePurchase(purchase.id)">
                    <i class="fas fa-trash text-danger"></i>
                  </button>
                </div>
              </td>
            </tr>
            
            <tr *ngIf="!isLoading && filteredPurchases.length === 0">
              <td colspan="10" class="text-center">No data available in table</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Totals Row -->
      <div class="table-responsive" *ngIf="!isLoading">
        <table class="table table-bordered">
          <tbody>
            <tr>
              <td class="fw-bold text-end" style="width: 20%">Total:</td>
              <td style="width: 10%"></td>
              <td style="width: 10%"></td>
              <td style="width: 10%"></td>
              <td style="width: 10%"></td>
              <td style="width: 10%"></td>
              <td style="width: 10%">₹ {{ calculateTotal('grandTotal') }}</td>
              <td style="width: 20%">
                <div>Purchase Due - ₹ {{ calculateTotal('paymentDue') }}</div>
                <div>Purchase Return - ₹ 0.00</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination and Summary -->
      <div class="row mt-3">
        <div class="col-md-6">
          <p>Showing {{ filteredPurchases.length > 0 ? '1' : '0' }} to {{ filteredPurchases.length }} of {{ purchases.length }} entries</p>
        </div>
        <div class="col-md-6">
          <nav aria-label="Page navigation" class="float-end">
            <ul class="pagination pagination-sm">
              <li class="page-item disabled">
                <a class="page-link" href="#" tabindex="-1">Previous</a>
              </li>
              <li class="page-item active"><a class="page-link" href="#">1</a></li>
              <li class="page-item disabled">
                <a class="page-link" href="#">Next</a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>