<!-- list-draft.component.html -->
<div class="drafts-container">
  <h2>List of Drafts</h2>
  <!-- Update the header-section in list-draft.component.html -->

  <div class="header-section">

  </div>
  <div class="header-actions">
    <button class="btn-add" (click)="navigateToAddDraft()">
      <i class="fas fa-plus"></i> Add 
    </button>
  </div>
  <!-- Action Bar -->
  <div class="action-bar">
    <div class="left-actions">
      <div class="entries-selector">
        <span>Show</span>
        <select [(ngModel)]="entriesPerPage" (change)="updatePagination()">
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
        <span>entries</span>
      </div>
      
      <button class="btn btn-export" (click)="exportCSV()">
        <i class="fas fa-file-csv"></i> Export CSV
      </button>
      
      <button class="btn btn-export" (click)="exportExcel()">
        <i class="fas fa-file-excel"></i> Export Excel
      </button>
      
      <button class="btn btn-print" (click)="printTable()">
        <i class="fas fa-print"></i> Print
      </button>
      
      <div class="column-visibility-container">
        <button class="btn btn-columns" (click)="toggleColumnVisibility()">
          <i class="fas fa-columns"></i> Column visibility
        </button>
        <div class="column-visibility-dropdown" *ngIf="showColumnVisibility">
          <div class="visibility-option" (click)="toggleColumn('sno')">
            <input type="checkbox" [checked]="columnVisibility.sno" />
            <span>S.No</span>
          </div>
          <div class="visibility-option" (click)="toggleColumn('customer')">
            <input type="checkbox" [checked]="columnVisibility.customer" />
            <span>Customer name</span>
          </div>
          <div class="visibility-option" (click)="toggleColumn('saleDate')">
            <input type="checkbox" [checked]="columnVisibility.saleDate" />
            <span>Sale Date</span>
          </div>
          <div class="visibility-option" (click)="toggleColumn('discountAmount')">
            <input type="checkbox" [checked]="columnVisibility.discountAmount" />
            <span>Discount Amount</span>
          </div>
          <div class="visibility-option" (click)="toggleColumn('totalPayable')">
            <input type="checkbox" [checked]="columnVisibility.totalPayable" />
            <span>Total Payable</span>
          </div>
          <div class="visibility-option" (click)="toggleColumn('shippingCharges')">
            <input type="checkbox" [checked]="columnVisibility.shippingCharges" />
            <span>Shipping Charges</span>
          </div>
          <div class="visibility-option" (click)="toggleColumn('shippingStatus')">
            <input type="checkbox" [checked]="columnVisibility.shippingStatus" />
            <span>Shipping Status</span>
          </div>
          <div class="visibility-option" (click)="toggleColumn('action')">
            <input type="checkbox" [checked]="columnVisibility.action" />
            <span>Action</span>
          </div>
        </div>
      </div>
      
      <button class="btn btn-export" (click)="exportPDF()">
        <i class="fas fa-file-pdf"></i> Export PDF
      </button>
      
    
    <div class="right-actions">
      <div class="search-box">
        <input type="text" placeholder="Search..." [(ngModel)]="searchQuery" (input)="applySearch()">
      </div>
    </div>
  </div>
  
  <!-- Drafts Table -->
  <div class="drafts-table" id="drafts-table">
    <table class="drafts-list-table">
      <thead>
        <tr>
          <th *ngIf="columnVisibility.sno">S.No</th>
          <th *ngIf="columnVisibility.customer" class="sortable" (click)="sortBy('customer')">Customer </th>
          <th *ngIf="columnVisibility.saleDate" class="sortable" (click)="sortBy('saleDate')">Sale Date </th>
          <th *ngIf="columnVisibility.discountAmount" class="sortable" (click)="sortBy('discountAmount')">Discount Amount </th>
          <th *ngIf="columnVisibility.totalPayable" class="sortable" (click)="sortBy('totalPayable')">Total Payable </th>
          <th *ngIf="columnVisibility.shippingCharges" class="sortable" (click)="sortBy('shippingCharges')">Shipping Charges </th>
          <th *ngIf="columnVisibility.shippingStatus" class="sortable" (click)="sortBy('shippingStatus')">Shipping Status </th>
          <th *ngIf="columnVisibility.action">Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="displayedDrafts.length === 0">
          <td [attr.colspan]="
            (columnVisibility.sno ? 1 : 0) +
            (columnVisibility.customer ? 1 : 0) +
            (columnVisibility.saleDate ? 1 : 0) +
            (columnVisibility.discountAmount ? 1 : 0) +
            (columnVisibility.totalPayable ? 1 : 0) +
            (columnVisibility.shippingCharges ? 1 : 0) +
            (columnVisibility.shippingStatus ? 1 : 0) +
            (columnVisibility.action ? 1 : 0)" class="no-data">No data available in table</td>
        </tr>
        <tr *ngFor="let draft of displayedDrafts; let i = index">
          <td *ngIf="columnVisibility.sno">{{ (currentPage - 1) * entriesPerPage + i + 1 }}</td>
          <td *ngIf="columnVisibility.customer">{{ draft.customer }}</td>
          <td *ngIf="columnVisibility.saleDate">{{ draft.saleDate | date: 'short' }}</td>
          <td *ngIf="columnVisibility.discountAmount">{{ draft.discountAmount | currency }}</td>
          <td *ngIf="columnVisibility.totalPayable">{{ calculateTotalPayable(draft) | currency }}</td>
          <td *ngIf="columnVisibility.shippingCharges">{{ draft.shippingCharges | currency }}</td>
          <td *ngIf="columnVisibility.shippingStatus">
            <span class="status-badge" [ngClass]="{
              'status-pending': draft.shippingStatus === 'pending',
              'status-shipped': draft.shippingStatus === 'shipped',
              'status-delivered': draft.shippingStatus === 'delivered'
            }">
              {{ draft.shippingStatus }}
            </span>
          </td>
          <td *ngIf="columnVisibility.action" class="actions">
            <button class="btn-edit" (click)="editDraft(draft)">
              <i class="fas fa-edit"></i> Edit
            </button>
            <button class="btn-delete" (click)="deleteDraft(draft.id)">
              <i class="fas fa-trash-alt"></i> Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <!-- Pagination -->
  <div class="bottom-actions">
    <div class="pagination-info">
      Showing {{ startEntry }} to {{ endEntry }} of {{ totalEntries }} entries
    </div>
    
    <div class="pagination">
      <button class="btn-page" [disabled]="currentPage === 1" (click)="previousPage()">Previous</button>
      <button class="btn-page" [disabled]="currentPage === totalPages" (click)="nextPage()">Next</button>
    </div>
  </div>
  
  <!-- Edit Form Modal -->
  <div *ngIf="showEditForm" class="modal-overlay">
    <div class="modal-container">
      <div class="modal-header">
        <h3>Edit Draft</h3>
        <button class="close-btn" (click)="closeEditForm()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <form [formGroup]="editForm" (ngSubmit)="saveDraft()">
          <div class="form-group">
            <label>Customer</label>
            <input type="text" formControlName="customer" class="form-control">
            <div *ngIf="editForm.get('customer')?.invalid && editForm.get('customer')?.touched" class="error-message">
              Customer name is required
            </div>
          </div>
          
          <div class="form-group">
            <label>Sale Date</label>
            <input type="datetime-local" formControlName="saleDate" class="form-control">
            <div *ngIf="editForm.get('saleDate')?.invalid && editForm.get('saleDate')?.touched" class="error-message">
              Sale date is required
            </div>
          </div>
          
          <div class="form-group">
            <label>Discount Amount</label>
            <input type="number" formControlName="discountAmount" class="form-control">
            <div *ngIf="editForm.get('discountAmount')?.invalid && editForm.get('discountAmount')?.touched" class="error-message">
              Valid amount required (minimum 0)
            </div>
          </div>
          
          <div class="form-group">
            <label>Shipping Charges</label>
            <input type="number" formControlName="shippingCharges" class="form-control">
            <div *ngIf="editForm.get('shippingCharges')?.invalid && editForm.get('shippingCharges')?.touched" class="error-message">
              Valid amount required (minimum 0)
            </div>
          </div>
          
          <div class="form-group">
            <label>Shipping Status</label>
            <select formControlName="shippingStatus" class="form-control">
              <option value="pending">Pending</option>
              <option value="shipped">Shipped</option>
              <option value="delivered">Delivered</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </div>
          
          <div class="form-actions">
            <button type="submit" class="btn btn-save" [disabled]="editForm.invalid">Save </button>

            <button type="button" class="btn btn-cancel" (click)="closeEditForm()">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>